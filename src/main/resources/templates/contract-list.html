<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="eng">
<head>
  <title>Kontraktlar</title>
  <link rel="stylesheet" type="text/css" th:href="@{/css/navbar.css}">
  <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
</head>
<body>
<div class="navbar">
  <div class="logo">BD</div>
  <ul>
    <li><a th:href="@{/}">Baş sahypa</a></li>
    <li><a th:href="@{/drug-models}">Dermanlar</a></li>
    <li><a th:href="@{/contracts}">Ýükler</a></li>
  </ul>
</div>


<style>
  .action-container {
      position: relative;
      display: inline-block;
  }

  .menu-icon {
      cursor: pointer;
      font-size: 20px;
      padding: 5px;
  }

  .dropdown-menu {
      display: none;
      position: absolute;
      right: 0;
      background: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
      padding: 5px;
      z-index: 10;
      min-width: 100px;
  }

  .dropdown-menu a {
      display: block;
      padding: 5px 5px;
      text-decoration: none;
      color: black;
  }

  .dropdown-menu a:hover {
      background: #f0f0f0;
  }

  .show {
      display: block;
  }
</style>

<form style="margin-top:20px" th:action="@{/contracts}" method="get">


  <label>Ýyl:
    <input type="number" name="year" th:value="${year}" style="width: 50px;" />
  </label>

  <label>Aýy:
    <select name="month">
      <option value="" th:selected="${month == null}">-- Aý saýla --</option>
      <option th:each="entry : ${months.entrySet()}"
              th:value="${entry.key}"
              th:text="${entry.value}"
              th:selected="${entry.key == month}">
      </option>
    </select>
  </label>




  <button type="submit">Filter</button>
</form>

<table>
  <thead>
  <tr>
    <th>№</th>
    <th>Akt Nomer</th>
    <th>Gelen senesi</th>
    <th>Maşynlaryň sany</th>
    <th>&#8942;</th>

  </tr>
  </thead>
  <tbody>
  <tr th:each="contract, iterStat : ${contracts}"
      th:classappend="${contract.closed != true ? ' not-closed' : ''}">    <td th:text="${iterStat.count}"></td>

    <td>
      <a th:href="@{/drugs(contractId=${contract.id})}" th:text="${contract.actNumber}"></a>
    </td>


    <td th:text="${#temporals.format(contract.arrivedAt, 'dd.MM.yyyy')}"></td>

    <td th:text="${contract.numberOfCars}"></td>

    <td>
      <div class="action-container">
        <span class="menu-icon" th:attr="onclick=|toggleMenu(event, '${contract.id}')|">&#8942;</span>
        <div th:id="'menu-' + ${contract.id}" class="dropdown-menu">
          <a th:href="@{/contracts/edit/{id}(id=${contract.id})}">Üýtget</a>
          <br>
          <a th:href="@{/contracts/delete/{id}(id=${contract.id}, contractId=${contractId})}" onclick="return confirm('Siz hakykatdanam pozmak isleýärsiňizmi?');">
            Poz
          </a>
        </div>
      </div>
    </td>
  </tr>
  </tbody>
</table>

<a th:href="@{/contracts/add-drugs}" class="add-drug-btn">Ýük goşmak</a>


<script>
  function toggleMenu(event, id) {
      event.stopPropagation(); // Prevent event from bubbling
      let menu = document.getElementById("menu-" + id);

      // Close all other menus
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
          menu.classList.remove('show');
      });

      // Toggle the clicked menu
      if (menu) {
          menu.classList.toggle("show");
      }
  }

  window.onclick = function() {
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
          menu.classList.remove('show');
      });
  };
</script>
</body>
</html>